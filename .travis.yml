# Build on Ubuntu 18.04
dist: bionic

# Specify language
language: cpp

# Build with both clang and gcc
compiler:
  - clang
  - g++

# Build all branches except gh-pages
branches:
  except:
    - gh-pages

# Install dependencies
before_install:
  - sudo apt remove --purge --auto-remove cmake
  - wget -O - https://apt.kitware.com/keys/kitware-archive-latest.asc 2>/dev/null | gpg --dearmor - | sudo tee /etc/apt/trusted.gpg.d/kitware.gpg >/dev/null
  - sudo apt-add-repository 'deb https://apt.kitware.com/ubuntu/ bionic main'
  - sudo apt-get update
  - sudo apt-get install -y --install-recommends build-essential cmake ninja-build docutils-common nodejs npm
  - sudo pip install conan

# Make and install
install:
  - mkdir build && cd build
  - conan install ..
  - cmake .. -DCMAKE_BUILD_TYPE=RelWithDebInfo -DBUILD_BENCHMARKS=ON -G Ninja
  - ninja
  - CTEST_OUTPUT_ON_FAILURE=1 ninja test
  - sudo ninja install

# Test the Rust support as well
matrix:
  include:
    - language: rust
      rust: stable
      before_install: true
      install: true
      script: cargo test --manifest-path rust/Cargo.toml

